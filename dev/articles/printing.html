<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Printing a tibble: Control and data flow • pillar</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Printing a tibble: Control and data flow">
<meta property="og:description" content="pillar">
<meta name="robots" content="noindex">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">pillar</a>
        <span class="version label label-danger" data-toggle="tooltip" data-placement="bottom" title="In-development version">1.4.99.9007</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/pillar-package.html#package-options">Options</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/r-lib/pillar/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="printing_files/accessible-code-block-0.0.1/empty-anchor.js"></script><script src="printing_files/htmlwidgets-1.5.3/htmlwidgets.js"></script><script src="printing_files/d3-3.3.8/d3.min.js"></script><script src="printing_files/dagre-0.4.0/dagre-d3.min.js"></script><link href="printing_files/mermaid-0.3.0/dist/mermaid.css" rel="stylesheet">
<script src="printing_files/mermaid-0.3.0/dist/mermaid.slim.min.js"></script><link href="printing_files/DiagrammeR-styles-0.2/styles.css" rel="stylesheet">
<script src="printing_files/chromatography-0.1/chromatography.js"></script><script src="printing_files/DiagrammeR-binding-1.0.6.1/DiagrammeR.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Printing a tibble: Control and data flow</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/r-lib/pillar/blob/master/vignettes/printing.Rmd" class="external-link"><code>vignettes/printing.Rmd</code></a></small>
      <div class="hidden name"><code>printing.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://pillar.r-lib.org/">pillar</a></span><span class="op">)</span></code></pre></div>
<p>What happens when a tibble is printed? This vignette documents the control flow and the data flow, explains the design choices, and shows the default implementation for the <code>"tbl"</code> class. It is mainly of interest for implementers of table subclasses. Customizing the formatting of a vector class in a tibble is described in <code><a href="https://vctrs.r-lib.org/articles/pillar.html" class="external-link">vignette("pillar", package = "vctrs")</a></code>.</p>
<div id="requirements" class="section level2">
<h2 class="hasAnchor">
<a href="#requirements" class="anchor"></a>Requirements</h2>
<ul>
<li><p>Fit into pre-specified width, distributing across multiple tiers if necessary</p></li>
<li><p>Optionally shrink and stretch individual columns</p></li>
<li>
<p>Header, body and footer for the tibble</p>
<ul>
<li>Avoid recomputation of information</li>
</ul>
</li>
<li>
<p>Custom components for the pillars in a tibble, top-aligned</p>
<ul>
<li>The container, not the column vectors, determine the appearance</li>
</ul>
</li>
<li><p>Customization of the entire output and of the pillars</p></li>
<li><p>Support for data frame columns (packed data frames) and matrix/array columns</p></li>
</ul>
</div>
<div id="overview" class="section level2">
<h2 class="hasAnchor">
<a href="#overview" class="anchor"></a>Overview</h2>
<p>The overall control and data flow are illustrated in the diagram below. Boxes are functions and methods. Solid lines are function calls. Dotted lines represent information that a function obtains via argument or (in the case of options) queries actively.</p>
<div id="htmlwidget-df9927b92f921ee9e1ae" style="width:700px;height:432.632880098888px;" class="DiagrammeR html-widget"></div>
<script type="application/json" data-for="htmlwidget-df9927b92f921ee9e1ae">{"x":{"diagram":"graph TD\n  print.tbl[\"print.tbl()\"] --> format.tbl[\"format.tbl()\"]\n  format.tbl --> tbl_format_setup[\"tbl_format_setup()\"]\n  options(Options: n and n_extra) -.-> tbl_format_setup\n  format.tbl --> tbl_format_header[\"tbl_format_header()\"]\n  format.tbl --> tbl_format_body[\"tbl_format_body()\"]\n  format.tbl --> tbl_format_footer[\"tbl_format_footer()\"]\n  tbl_format_setup -.-> tbl_sum[\"tbl_sum()\"]\n  tbl_sum -.-> setup(Setup object)\n  tbl_format_setup -.-> ctl_new_compound_pillar[\"ctl_new_compound_pillar()\"]\n  ctl_new_compound_pillar -.-> ctl_new_pillar[\"ctl_new_pillar()\"]\n  ctl_new_pillar -.-> setup(Setup object)\n  setup -.-> tbl_format_header\n  setup -.-> tbl_format_body\n  setup -.-> tbl_format_footer\n  tbl_format_header -.-> print(Printed output)\n  tbl_format_body -.-> print\n  tbl_format_footer -.-> print"},"evals":[],"jsHooks":[]}</script>
</div>
<div id="initialization" class="section level2">
<h2 class="hasAnchor">
<a href="#initialization" class="anchor"></a>Initialization</h2>
<p>A tibble is a list of columns of class <code>"tbl_df"</code> and <code>"tbl"</code>. Printing is designed to work for non-data-frame table-like objects such as lazy tables. The <code><a href="../reference/format_tbl.html">print.tbl()</a></code> method calls <code><a href="https://rdrr.io/r/base/format.html" class="external-link">format()</a></code> for the object and prints the output. The <code><a href="../reference/format_tbl.html">format.tbl()</a></code> method creates a setup object, and uses that object to format header, body and footer.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tbl</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, b <span class="op">=</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>c <span class="op">=</span> <span class="fl">4</span><span class="op">:</span><span class="fl">6</span>, d <span class="op">=</span> <span class="fl">7</span><span class="op">:</span><span class="fl">9</span><span class="op">)</span>, e <span class="op">=</span> <span class="fl">10</span><span class="op">:</span><span class="fl">12</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">tbl</span>, width <span class="op">=</span> <span class="fl">23</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 3 x 3</span>
<span class="co">#&gt;       a   b$c    $d</span>
<span class="co">#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;</span>
<span class="co">#&gt; 1     1     4     7</span>
<span class="co">#&gt; 2     2     5     8</span>
<span class="co">#&gt; 3     3     6     9</span>
<span class="co">#&gt; # … with 1 more</span>
<span class="co">#&gt; #   variable: e &lt;int&gt;</span>
<span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">tbl</span><span class="op">)</span>
<span class="co">#&gt; tibble [3 × 3] (S3: tbl_df/tbl/data.frame)</span>
<span class="co">#&gt;  $ a: int [1:3] 1 2 3</span>
<span class="co">#&gt;  $ b: tibble [3 × 2] (S3: tbl_df/tbl/data.frame)</span>
<span class="co">#&gt;   ..$ c: int [1:3] 4 5 6</span>
<span class="co">#&gt;   ..$ d: int [1:3] 7 8 9</span>
<span class="co">#&gt;  $ e: int [1:3] 10 11 12</span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">pillar</span><span class="fu">:::</span><span class="va"><a href="../reference/format_tbl.html">print.tbl</a></span>
<span class="co">#&gt; function (x, width = NULL, ..., n = NULL, n_extra = NULL) </span>
<span class="co">#&gt; {</span>
<span class="co">#&gt;     writeLines(format(x, width = width, ..., n = n, n_extra = n_extra))</span>
<span class="co">#&gt;     invisible(x)</span>
<span class="co">#&gt; }</span>
<span class="co">#&gt; &lt;bytecode: 0x557655b84bb0&gt;</span>
<span class="co">#&gt; &lt;environment: namespace:pillar&gt;</span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">pillar</span><span class="fu">:::</span><span class="va"><a href="../reference/format_tbl.html">format.tbl</a></span>
<span class="co">#&gt; function (x, width = NULL, ..., n = NULL, n_extra = NULL) </span>
<span class="co">#&gt; {</span>
<span class="co">#&gt;     check_dots_empty(action = signal)</span>
<span class="co">#&gt;     setup &lt;- tbl_format_setup(x, width = width, ..., n = n, max_extra_cols = n_extra)</span>
<span class="co">#&gt;     header &lt;- tbl_format_header(x, setup)</span>
<span class="co">#&gt;     body &lt;- tbl_format_body(x, setup)</span>
<span class="co">#&gt;     footer &lt;- tbl_format_footer(x, setup)</span>
<span class="co">#&gt;     c(header, body, footer)</span>
<span class="co">#&gt; }</span>
<span class="co">#&gt; &lt;bytecode: 0x557655b7e148&gt;</span>
<span class="co">#&gt; &lt;environment: namespace:pillar&gt;</span></code></pre></div>
<p>While it’s possible to extend or override these methods for your <code>"tbl"</code> subclass, often overriding the more specialized methods shown below is sufficient.</p>
</div>
<div id="setup" class="section level2">
<h2 class="hasAnchor">
<a href="#setup" class="anchor"></a>Setup</h2>
<p>Most of the work for formatting actually happens in <code><a href="../reference/tbl_format_setup.html">tbl_format_setup()</a></code>. The desired output width is baked into the setup object and must be available when calling. Setup objects print like a tibble but with a clear separation of header, body, and footer.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">setup</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tbl_format_setup.html">tbl_format_setup</a></span><span class="op">(</span><span class="va">tbl</span>, width <span class="op">=</span> <span class="fl">24</span><span class="op">)</span>
<span class="va">setup</span>
<span class="co">#&gt; &lt;pillar_tbl_format_setup&gt;</span>
<span class="co">#&gt; &lt;tbl_format_header(setup)&gt;</span>
<span class="co">#&gt; # A tibble: 3 x 3</span>
<span class="co">#&gt; &lt;tbl_format_body(setup)&gt;</span>
<span class="co">#&gt;       a   b$c    $d</span>
<span class="co">#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;</span>
<span class="co">#&gt; 1     1     4     7</span>
<span class="co">#&gt; 2     2     5     8</span>
<span class="co">#&gt; 3     3     6     9</span>
<span class="co">#&gt; &lt;tbl_format_footer(setup)&gt;</span>
<span class="co">#&gt; # … with 1 more</span>
<span class="co">#&gt; #   variable: e &lt;int&gt;</span></code></pre></div>
<p>A setup object is required here to avoid computing information twice. For instance, the dimensions shown in the header or the extra columns displayed in the footer are available only after the body has been computed.</p>
<p>The generic dispatches over the container, so that you can override it if necessary. It is responsible for assigning default values to arguments before passing them on to the method.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tbl_format_setup</span>
<span class="co">#&gt; function (x, width = NULL, ..., n = NULL, max_extra_cols = NULL) </span>
<span class="co">#&gt; {</span>
<span class="co">#&gt;     "!!DEBUG tbl_format_setup()"</span>
<span class="co">#&gt;     width &lt;- get_width_print(width)</span>
<span class="co">#&gt;     n &lt;- get_n_print(n, nrow(x))</span>
<span class="co">#&gt;     max_extra_cols &lt;- get_max_extra_cols(max_extra_cols)</span>
<span class="co">#&gt;     out &lt;- tbl_format_setup_(x, width, ..., n = n, max_extra_cols = max_extra_cols)</span>
<span class="co">#&gt;     return(out)</span>
<span class="co">#&gt;     UseMethod("tbl_format_setup")</span>
<span class="co">#&gt; }</span>
<span class="co">#&gt; &lt;bytecode: 0x557652a7f360&gt;</span>
<span class="co">#&gt; &lt;environment: namespace:pillar&gt;</span></code></pre></div>
<p>The default implementation converts the input to a data frame via <code><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame(head(x))</a></code>, and returns an object constructed with <code><a href="../reference/new_tbl_format_setup.html">new_tbl_format_setup()</a></code> that contains the data frame and additional information. If you override this method, e.g. to incorporate more information, you can add new items to the default setup object, but you should not overwrite existing items.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">pillar</span><span class="fu">:::</span><span class="va"><a href="../reference/tbl_format_setup.html">tbl_format_setup.tbl</a></span>
<span class="co">#&gt; function (x, width, ..., n, max_extra_cols) </span>
<span class="co">#&gt; {</span>
<span class="co">#&gt;     "!!DEBUG tbl_format_setup.tbl()"</span>
<span class="co">#&gt;     rows &lt;- nrow(x)</span>
<span class="co">#&gt;     if (is.na(rows)) {</span>
<span class="co">#&gt;         df &lt;- as.data.frame(head(x, n + 1))</span>
<span class="co">#&gt;         if (nrow(df) &lt;= n) {</span>
<span class="co">#&gt;             rows &lt;- nrow(df)</span>
<span class="co">#&gt;         }</span>
<span class="co">#&gt;         else {</span>
<span class="co">#&gt;             df &lt;- df[seq_len(n), , drop = FALSE]</span>
<span class="co">#&gt;         }</span>
<span class="co">#&gt;     }</span>
<span class="co">#&gt;     else {</span>
<span class="co">#&gt;         df &lt;- as.data.frame(head(x, n))</span>
<span class="co">#&gt;     }</span>
<span class="co">#&gt;     if (is.na(rows)) {</span>
<span class="co">#&gt;         needs_dots &lt;- (nrow(df) &gt;= n)</span>
<span class="co">#&gt;     }</span>
<span class="co">#&gt;     else {</span>
<span class="co">#&gt;         needs_dots &lt;- (rows &gt; n)</span>
<span class="co">#&gt;     }</span>
<span class="co">#&gt;     if (needs_dots) {</span>
<span class="co">#&gt;         rows_missing &lt;- rows - n</span>
<span class="co">#&gt;     }</span>
<span class="co">#&gt;     else {</span>
<span class="co">#&gt;         rows_missing &lt;- 0L</span>
<span class="co">#&gt;     }</span>
<span class="co">#&gt;     tbl_sum &lt;- tbl_sum(x)</span>
<span class="co">#&gt;     rownames(df) &lt;- NULL</span>
<span class="co">#&gt;     body &lt;- ctl_colonnade(df, has_row_id = if (.row_names_info(x) &gt; </span>
<span class="co">#&gt;         0) </span>
<span class="co">#&gt;         "*"</span>
<span class="co">#&gt;     else TRUE, width = width, controller = x)</span>
<span class="co">#&gt;     extra_cols &lt;- attr(body, "extra_cols")</span>
<span class="co">#&gt;     extra_cols_total &lt;- length(extra_cols)</span>
<span class="co">#&gt;     if (extra_cols_total &gt; max_extra_cols) {</span>
<span class="co">#&gt;         length(extra_cols) &lt;- max_extra_cols</span>
<span class="co">#&gt;     }</span>
<span class="co">#&gt;     new_tbl_format_setup(x = x, width = width, tbl_sum = tbl_sum, </span>
<span class="co">#&gt;         body = body, rows_body = nrow(df), rows_missing = rows_missing, </span>
<span class="co">#&gt;         rows_total = rows, extra_cols = extra_cols, extra_cols_total = extra_cols_total)</span>
<span class="co">#&gt; }</span>
<span class="co">#&gt; &lt;bytecode: 0x5576520dd3a8&gt;</span>
<span class="co">#&gt; &lt;environment: namespace:pillar&gt;</span></code></pre></div>
<p>At the core, the internal function <code>ctl_colonnade()</code> composes the body. Its functionality and the customization points it offers are detailed in the “Colonnade” section below.</p>
</div>
<div id="header-body-footer" class="section level2">
<h2 class="hasAnchor">
<a href="#header-body-footer" class="anchor"></a>Header, body, footer</h2>
<p>The components of a tibble are formatted with <code>tbl_format_*()</code> generics, which also dispatch on the container to allow extension or overrides. They return a character vector, with one element per line printed. The setup object is required.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/tbl_format_header.html">tbl_format_header</a></span><span class="op">(</span><span class="va">tbl</span>, <span class="va">setup</span><span class="op">)</span>
<span class="co">#&gt; [1] "# A tibble: 3 x 3"</span>
<span class="fu"><a href="../reference/tbl_format_body.html">tbl_format_body</a></span><span class="op">(</span><span class="va">tbl</span>, <span class="va">setup</span><span class="op">)</span>
<span class="co">#&gt;       a   b$c    $d</span>
<span class="co">#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;</span>
<span class="co">#&gt; 1     1     4     7</span>
<span class="co">#&gt; 2     2     5     8</span>
<span class="co">#&gt; 3     3     6     9</span>
<span class="fu"><a href="../reference/tbl_format_footer.html">tbl_format_footer</a></span><span class="op">(</span><span class="va">tbl</span>, <span class="va">setup</span><span class="op">)</span>
<span class="co">#&gt; [1] "# … with 1 more"       "#   variable: e &lt;int&gt;"</span></code></pre></div>
<p>(The body is returned as a classed object with a <code><a href="https://rdrr.io/r/base/print.html" class="external-link">print()</a></code> method, it is still a <code><a href="https://rdrr.io/r/base/character.html" class="external-link">character()</a></code> under the hood.)</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="fu"><a href="../reference/tbl_format_body.html">tbl_format_body</a></span><span class="op">(</span><span class="va">tbl</span>, <span class="va">setup</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; [1] "pillar_vertical"</span>
<span class="fu"><a href="https://rdrr.io/r/base/typeof.html" class="external-link">typeof</a></span><span class="op">(</span><span class="fu"><a href="../reference/tbl_format_body.html">tbl_format_body</a></span><span class="op">(</span><span class="va">tbl</span>, <span class="va">setup</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; [1] "character"</span></code></pre></div>
<p>Since most of the work already has been carried out in <code><a href="../reference/tbl_format_setup.html">tbl_format_setup()</a></code>, the default implementations mostly consist of code that styles and wraps the output.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">pillar</span><span class="fu">:::</span><span class="va">tbl_format_header.tbl</span>
<span class="co">#&gt; function (x, setup, ...) </span>
<span class="co">#&gt; {</span>
<span class="co">#&gt;     named_header &lt;- setup$tbl_sum</span>
<span class="co">#&gt;     if (all(names2(named_header) == "")) {</span>
<span class="co">#&gt;         header &lt;- named_header</span>
<span class="co">#&gt;     }</span>
<span class="co">#&gt;     else {</span>
<span class="co">#&gt;         header &lt;- paste0(justify(paste0(names2(named_header), </span>
<span class="co">#&gt;             ":"), right = FALSE, space = NBSP), " ", named_header)</span>
<span class="co">#&gt;     }</span>
<span class="co">#&gt;     style_subtle(format_comment(header, width = setup$width))</span>
<span class="co">#&gt; }</span>
<span class="co">#&gt; &lt;bytecode: 0x557655a8e308&gt;</span>
<span class="co">#&gt; &lt;environment: namespace:pillar&gt;</span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">pillar</span><span class="fu">:::</span><span class="va">tbl_format_body.tbl</span>
<span class="co">#&gt; function (x, setup, ...) </span>
<span class="co">#&gt; {</span>
<span class="co">#&gt;     force(setup)</span>
<span class="co">#&gt;     setup$body</span>
<span class="co">#&gt; }</span>
<span class="co">#&gt; &lt;bytecode: 0x557655d6df60&gt;</span>
<span class="co">#&gt; &lt;environment: namespace:pillar&gt;</span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">pillar</span><span class="fu">:::</span><span class="va">tbl_format_footer.tbl</span>
<span class="co">#&gt; function (x, setup, ...) </span>
<span class="co">#&gt; {</span>
<span class="co">#&gt;     footer &lt;- pre_dots(format_footer(x, setup))</span>
<span class="co">#&gt;     footer_comment &lt;- split_lines(format_comment(footer, width = setup$width))</span>
<span class="co">#&gt;     style_subtle(footer_comment)</span>
<span class="co">#&gt; }</span>
<span class="co">#&gt; &lt;bytecode: 0x557655d70900&gt;</span>
<span class="co">#&gt; &lt;environment: namespace:pillar&gt;</span></code></pre></div>
</div>
<div id="colonnade" class="section level2">
<h2 class="hasAnchor">
<a href="#colonnade" class="anchor"></a>Colonnade</h2>
<p>The internal function <code>ctl_colonnade()</code> composes the body. It performs the following tasks:</p>
<ol style="list-style-type: decimal">
<li>Create a pillar object for every column that fits, using <code><a href="../reference/ctl_new_pillar.html">ctl_new_compound_pillar()</a></code>, <code><a href="../reference/ctl_new_pillar.html">ctl_new_pillar()</a></code> and ultimately <code><a href="../reference/pillar.html">pillar()</a></code> and <code><a href="../reference/pillar_shaft.html">pillar_shaft()</a></code>
</li>
<li>Determine the number of tiers and the width for each tier</li>
<li>Distribute the pillars across the tiers, assigning a width to each pillar.</li>
<li>Format each pillar via its <code><a href="https://rdrr.io/r/base/format.html" class="external-link">format()</a></code> function, passing the now known width.</li>
<li>Combine the formatted pillars horizontally.</li>
<li>Combine the tiers vertically.</li>
<li>Return the formatted body, and the columns that could not fit.</li>
</ol>
<p>In the following, the first and the fourth steps are discussed.</p>
</div>
<div id="creating-pillar-objects" class="section level2">
<h2 class="hasAnchor">
<a href="#creating-pillar-objects" class="anchor"></a>Creating pillar objects</h2>
<p>Each column in the tibble is passed to <code><a href="../reference/ctl_new_pillar.html">ctl_new_compound_pillar()</a></code>, which eventually calls <code><a href="../reference/ctl_new_pillar.html">ctl_new_pillar()</a></code> once or several times.</p>
<div id="compound-pillars" class="section level3">
<h3 class="hasAnchor">
<a href="#compound-pillars" class="anchor"></a>Compound pillars</h3>
<p>The <code><a href="../reference/ctl_new_pillar.html">ctl_new_compound_pillar()</a></code> generic dispatches on the container:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/ctl_new_pillar.html">ctl_new_compound_pillar</a></span><span class="op">(</span><span class="va">tbl</span>, <span class="va">tbl</span><span class="op">$</span><span class="va">a</span>, width <span class="op">=</span> <span class="fl">20</span><span class="op">)</span>
<span class="co">#&gt; &lt;pillar&gt;</span>
<span class="co">#&gt;                &lt;int&gt;</span>
<span class="co">#&gt;                    1</span>
<span class="co">#&gt;                    2</span>
<span class="co">#&gt;                    3</span>
<span class="fu"><a href="../reference/ctl_new_pillar.html">ctl_new_compound_pillar</a></span><span class="op">(</span><span class="va">tbl</span>, <span class="va">tbl</span><span class="op">$</span><span class="va">b</span>, width <span class="op">=</span> <span class="fl">20</span><span class="op">)</span>
<span class="co">#&gt; &lt;compound_pillar[2]&gt;</span>
<span class="co">#&gt;         c</span>
<span class="co">#&gt;     &lt;int&gt;</span>
<span class="co">#&gt;         4</span>
<span class="co">#&gt;         5</span>
<span class="co">#&gt;         6</span>
<span class="co">#&gt; … and 1 more sub-pillars</span></code></pre></div>
<p>The default method distinguishes between compound and simple pillars. Data frame, matrix, and array columns are decomposed into sub-pillars and returned as a compound pillar. Regular vectors are forwarded to <code><a href="../reference/ctl_new_pillar.html">ctl_new_pillar()</a></code>. Implementers of <code>"tbl"</code> subclasses will rarely if ever need to extend or override this method.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">pillar</span><span class="fu">:::</span><span class="va">ctl_new_compound_pillar.tbl</span>
<span class="co">#&gt; function (controller, x, width, ..., title = NULL) </span>
<span class="co">#&gt; {</span>
<span class="co">#&gt;     "!!DEBUG ctl_new_compound_pillar.tbl()"</span>
<span class="co">#&gt;     if (is.data.frame(x)) {</span>
<span class="co">#&gt;         new_data_frame_pillar(x, controller, width, title = title)</span>
<span class="co">#&gt;     }</span>
<span class="co">#&gt;     else if (is.matrix(x)) {</span>
<span class="co">#&gt;         new_matrix_pillar(x, controller, width, title = title)</span>
<span class="co">#&gt;     }</span>
<span class="co">#&gt;     else if (is.array(x) &amp;&amp; length(dim(x)) &gt; 1) {</span>
<span class="co">#&gt;         new_array_pillar(x, controller, width, title = title)</span>
<span class="co">#&gt;     }</span>
<span class="co">#&gt;     else {</span>
<span class="co">#&gt;         ctl_new_pillar(controller, x, width, ..., title = prepare_title(title))</span>
<span class="co">#&gt;     }</span>
<span class="co">#&gt; }</span>
<span class="co">#&gt; &lt;bytecode: 0x557651db8ac8&gt;</span>
<span class="co">#&gt; &lt;environment: namespace:pillar&gt;</span></code></pre></div>
</div>
<div id="simple-pillars" class="section level3">
<h3 class="hasAnchor">
<a href="#simple-pillars" class="anchor"></a>Simple pillars</h3>
<p>The <code><a href="../reference/ctl_new_pillar.html">ctl_new_pillar()</a></code> method is called for columns that are not data frames or arrays, and also dispatches over the container.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">pillar</span><span class="fu">:::</span><span class="va">ctl_new_pillar.tbl</span>
<span class="co">#&gt; function (controller, x, width, ..., title = NULL) </span>
<span class="co">#&gt; {</span>
<span class="co">#&gt;     "!!DEBUG ctl_new_pillar.tbl()"</span>
<span class="co">#&gt;     pillar(x, title, if (!is.null(width)) </span>
<span class="co">#&gt;         max0(width))</span>
<span class="co">#&gt; }</span>
<span class="co">#&gt; &lt;bytecode: 0x557651db1ee8&gt;</span>
<span class="co">#&gt; &lt;environment: namespace:pillar&gt;</span></code></pre></div>
<p>The default method calls <code><a href="../reference/pillar.html">pillar()</a></code> directly, passing the maximum width available.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pillar</span>
<span class="co">#&gt; function (x, title = NULL, width = NULL, ...) </span>
<span class="co">#&gt; {</span>
<span class="co">#&gt;     "!!DEBUG pillar(`v(title)`, `v(width)`)"</span>
<span class="co">#&gt;     pillar_from_shaft(new_pillar_title(title), new_pillar_type(x), </span>
<span class="co">#&gt;         pillar_shaft(x, ...), width)</span>
<span class="co">#&gt; }</span>
<span class="co">#&gt; &lt;bytecode: 0x557651c4a040&gt;</span>
<span class="co">#&gt; &lt;environment: namespace:pillar&gt;</span></code></pre></div>
<p>Formatting for title and type is provided by <code><a href="../reference/new_pillar_title.html">new_pillar_title()</a></code> and <code><a href="../reference/new_pillar_type.html">new_pillar_type()</a></code>. The body can be customized by implementing <code><a href="../reference/pillar_shaft.html">pillar_shaft()</a></code> for a vector class, see <code><a href="https://vctrs.r-lib.org/articles/pillar.html" class="external-link">vignette("pillar", package = "vctrs")</a></code> for details. If title or type don’t fit the available width, <code><a href="../reference/pillar_shaft.html">pillar_shaft()</a></code> is never called.</p>
<p>This function now returns <code>NULL</code> if the width is insufficient to contain the data. It is possible to change the appearance of pillars by overriding or extending <code><a href="../reference/ctl_new_pillar.html">ctl_new_pillar()</a></code>, see the next section for details.</p>
</div>
<div id="components" class="section level3">
<h3 class="hasAnchor">
<a href="#components" class="anchor"></a>Components</h3>
<p>Both compound and simple pillar objects share the same structure and are ultimately constructed with <code><a href="../reference/new_pillar.html">new_pillar()</a></code>.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">new_pillar</span>
<span class="co">#&gt; function (components, ..., width = NULL, class = NULL) </span>
<span class="co">#&gt; {</span>
<span class="co">#&gt;     "!!DEBUG new_pillar(`v(width)`, `v(class)`)"</span>
<span class="co">#&gt;     check_dots_empty()</span>
<span class="co">#&gt;     if (length(components) &gt; 0 &amp;&amp; !is_named(components)) {</span>
<span class="co">#&gt;         abort("All components must have names.")</span>
<span class="co">#&gt;     }</span>
<span class="co">#&gt;     structure(components, width = width, class = c(class, "pillar"))</span>
<span class="co">#&gt; }</span>
<span class="co">#&gt; &lt;bytecode: 0x5576542ef0f8&gt;</span>
<span class="co">#&gt; &lt;environment: namespace:pillar&gt;</span></code></pre></div>
<p>A pillar is stored as a list of components. For simple pillars each component has length one, for compound pillars all components have the same length. In the future, this restriction may be levied to support nested components, e.g. for column titles spanning multiple sub-pillars for compound pillars. The maximum width available for the simple pillar of for each sub-pillar of a compound pillar is also recorded.</p>
<div class="figure">
<img src="pillar-objects.png" alt=""><p class="caption">Layout of the objects contained in a pillar</p>
</div>
</div>
</div>
<div id="formatting-pillars" class="section level2">
<h2 class="hasAnchor">
<a href="#formatting-pillars" class="anchor"></a>Formatting pillars</h2>
<p>When a pillar object is constructed, it has a minimum a desired (maximum) width. Because it depends on the number and width of other pillar objects that may not be even constructed, the final width is not known yet. It is passed to <code><a href="https://rdrr.io/r/base/format.html" class="external-link">format()</a></code>, which uses the desired width if empty:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">pillar</span><span class="fu">:::</span><span class="va">format.pillar</span>
<span class="co">#&gt; function (x, width = NULL, ...) </span>
<span class="co">#&gt; {</span>
<span class="co">#&gt;     if (is.null(width)) {</span>
<span class="co">#&gt;         width &lt;- get_width(x)</span>
<span class="co">#&gt;     }</span>
<span class="co">#&gt;     if (is.null(width)) {</span>
<span class="co">#&gt;         widths &lt;- pillar_get_widths(x)</span>
<span class="co">#&gt;         width &lt;- sum(widths) - length(widths) + 1L</span>
<span class="co">#&gt;     }</span>
<span class="co">#&gt;     out &lt;- pillar_format_parts_2(x, width)</span>
<span class="co">#&gt;     new_vertical(unlist(unname(out)))</span>
<span class="co">#&gt; }</span>
<span class="co">#&gt; &lt;bytecode: 0x55765528bd40&gt;</span>
<span class="co">#&gt; &lt;environment: namespace:pillar&gt;</span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by <a href="http://krlmlr.info" class="external-link">Kirill Müller</a>, <a href="http://hadley.nz" class="external-link">Hadley Wickham</a>.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 1.6.1.9000.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
